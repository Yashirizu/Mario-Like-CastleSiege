<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Castle-Siege</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>


<body>
    <script type="text/javascript">

        class title extends Phaser.Scene {
            constructor() {
                super("intro");
            }

            preload() {
                this.load.image('intro', 'assets/intro.png');
            }
            create() {
                this.image = this.add.image(700, 400, 'intro').setScale(2.5);
                this.image.setInteractive()

                this.image.on('pointerdown', this.onImageClicked, this);
            }
            update() {



            }
            onImageClicked() {
                this.scene.start('tuto')
            }
        }
        var cursors
        var platforms;
        var player;
        var ennemy;
        var gameover = false;
        var Heavyennemy;
        var lance;
        var clavier;
        var sword;
        var marteau;
        var hammer;
        var hammerColliders;
        var hammeractive = false
        var swordColliders;
        var swordactive = false
        var attackhammer;
        var porte;
        var block;
        var balcon;
        var equipe = 'paladin sword';
        

        class tuto extends Phaser.Scene {
            constructor() {
                super('tuto');
            }
            preload() {
                this.load.image('chapelle', 'assets/chapelle.png');
                this.load.image('decors-proto', 'assets/decors-proto.png');
                this.load.image('sky', 'assets/sky.png');
                this.load.image('ground', 'assets/platform.png');

                this.load.spritesheet('perso', 'assets/perso.png',
                    { frameWidth: 32, frameHeight: 48 });

                this.load.spritesheet('paladin sword','assets/sprite-paladin_epee_01.png',
                    {frameWidth:250, frameHeight:236});

                this.load.spritesheet('paladin hammer','assets/sprite-paladin_marteau_01.png',
                    {frameWidth:260, frameHeight:236});
                
                this.load.spritesheet('ennemy', 'assets/ennemis.png',
                    { frameWidth: 360, frameHeight: 280 });

                this.load.spritesheet('Heavyennemy', 'assets/red-armor.png',
                    { frameWidth: 500, frameHeight: 600 });

                this.load.spritesheet('epée', 'assets/epée.png',
                    { frameWidth: 48, frameHeight: 48 });
                    
                this.load.spritesheet('hammer', 'assets/hammer.png',
                    { frameWidth: 64, frameHeight: 64 });
                

            }
            create() {


                platforms = this.physics.add.staticGroup();
                // (hauteur puis gauche droite)
                platforms.create(410, 890, 'ground').setScale(2).refreshBody(); // plancher
                platforms.create(1100, 890, 'ground').setScale(2).refreshBody();
                platforms.create(1600, 890, 'ground').setScale(2).refreshBody();
                platforms.create(1200, 890, 'ground').setScale(2).refreshBody();
                platforms.create(500, 400, 'ground');
                platforms.create(50, 150, 'ground');
                platforms.create(750, 220, 'ground'); //en haut à droite
                //platforms.create(1200,600,'ground')
                platforms.create(700, 700, 'ground')



                porte = this.physics.add.sprite(3000, 3000, 'gjfio').setScale(2).setImmovable();
                this.add.image(100, 250, 'chapelle').setScale(1); // à mettre après les plateformes pour cacher les platforme derrière le décors
                
                
                //porte = this.allowGravity = false
                player = this.physics.add.sprite(300, 700, 'paladin sword').setScale(0.75);

                

                player.setBounce(0.2);
                player.setCollideWorldBounds(true);
                this.physics.add.collider(player, platforms);
                this.physics.add.collider(porte,platforms);

                this.cameras.main.setBounds(0, 0, 5500, 3220);
                // ancrage de la caméra sur le joueur
                this.cameras.main.startFollow(player);
                cursors = this.input.keyboard.createCursorKeys()
                this.physics.add.collider(player, porte, this.nextscene, null, this)
                
                
                
                this.anims.create({
                    key: 'left sword',
                    frames: this.anims.generateFrameNumbers('paladin sword', { start: 10, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn sword',
                    frames: this.anims.generateFrameNumbers ('paladin sword', {start: 20, end : 21}) ,
                    frameRate: 20
                })

                this.anims.create({
                    key: 'right sword',
                    frames: this.anims.generateFrameNumbers('paladin sword', { start: 0, end: 9 }),
                    frameRate: 10,
                    repeat: -1
                });
                
                

                this.anims.create({
                    key: 'left hammer',
                    frames: this.anims.generateFrameNumbers('paladin hammer', { start: 0, end: 9 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn hammer',
                    frames: this.anims.generateFrameNumbers ('paladin hammer', {start: 20, end : 21}) ,
                    frameRate: 20
                })

                this.anims.create({
                    key: 'right hammer',
                    frames: this.anims.generateFrameNumbers('paladin hammer', { start: 10, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'space',
                    frames:this.anims.generateFrameNumbers('paladin hammer', {start:22, end:27}),
                    frameRate:10,
                    repeat:0
                
                })

                this.anims.create({
                    key: 'attack',
                    frames: this.anims.generateFrameNumbers('epée', { start: 0, end: 7 }),
                    frameRate: 10,
                    repeat: 0
                });
                this.anims.create({
                    key: 'paladin sword attack',
                    frames:this.anims.generateFrameNumbers('paladin sword', {start: 23, end:29}),
                    frameRate:10,
                    repeat:0
                })
                this.anims.create({
                    key: 'paladin hammer attack',
                    frames:this.anims.generateFrameNumbers('paladin hammer', {start: 23, end:28}),
                    frameRate:5,
                    repeat:0
                })
                this.anims.create({
                    key: 'hammerattack',
                    frames: this.anims.generateFrameNumbers('hammer', { start: 0, end: 8 }),
                    frameRate: 20,
                    repeat: 0
                });
                
                

                ennemy = this.physics.add.sprite(750, 440, 'ennemy').setScale(0.5);

                ennemy.setSize(250, 250, true);
                this.physics.add.collider(ennemy, platforms);
                this.physics.add.collider(player, ennemy, handlePlayerEnnemyCollision, null, this);
                ennemy.setBounce(0.5);
                ennemy.setCollideWorldBounds(true);
                ennemy.allowGravity = true;
                //this.ennemy.vivant=true

                Heavyennemy = this.physics.add.sprite(750, 30, 'Heavyennemy');

                this.physics.add.collider(Heavyennemy, platforms);
                this.physics.add.collider(player, Heavyennemy, null, this);
                Heavyennemy.setBounce(0.5);
                Heavyennemy.setCollideWorldBounds(true);

                Heavyennemy.allowGravity = true;

                lance = this.physics.add.sprite(350, 400);

                lance.setSize(120, 60, true);
                //lance.setOffsize(10,10,true);

                this.physics.add.collider(lance, platforms);
                this.physics.add.collider(player, ennemy, null, this);
                lance.setCollideWorldBounds(true);
                lance.setBounce(0.5);
                lance.setImmovable(true);
                lance.allowGravity = true

                //UTILISATION DE L'EPEE
                sword = this.physics.add.sprite(1000, 1000, 'epée');
                sword.setOrigin(0, 0);
                sword.setSize(200, 40);
                sword.setImmovable(true);
                swordColliders = this.physics.add.group();
                swordColliders.add(sword);
                this.physics.add.overlap(player, sword, gravitysword);
                this.physics.add.overlap(sword, ennemy, attack);
                this.physics.add.collider(ennemy, swordColliders, handleSwordCollision, null, this);
                attack = this.input.keyboard.addKey('space');
                this.physics.add.collider(sword, ennemy, attack);


                // UTILISATION DU MARTEAU
                hammer = this.physics.add.sprite(1000, 1000, 'hammer').setScale(2);
                hammer.setOrigin(0, 0);
                hammer.setSize(60, 40);
                hammer.setImmovable(true);
                hammerColliders = this.physics.add.group();
                hammerColliders.add(hammer);
                this.physics.add.overlap(player, hammer, gravityhammer);
                this.physics.add.collider(hammer, ennemy, chockwave);
                this.physics.add.collider(hammer, Heavyennemy, chock);
                this.physics.add.collider(ennemy, hammerColliders, handleHammerCollision, null, this);
                attackhammer = this.input.keyboard.addKey('shift');



            }
            update() {
                porte.x=1500
                porte.y=500
                this.physics.add.collider(porte,platforms,null, this);
                if (equipe == 'paladin sword') {
                    if (cursors.left.isDown) { //si la touche gauche est appuyée
                        player.setVelocityX(-260); //alors vitesse négative en X
                        player.anims.play('left sword', true); //et animation => gauche
                    }
                    else if (cursors.right.isDown) { //sinon si la touche droite est appuyée
                        player.setVelocityX(260); //alors vitesse positive en X
                        player.anims.play('right sword', true); //et animation => droite
                    }
                    else if (cursors.space.isUp) { // sinon
                        player.setVelocityX(0); //vitesse nulle
                        player.anims.play('turn sword'); //animation fait face caméra
                    }
                }
                if (equipe == 'paladin hammer') {
                    if (cursors.left.isDown) { //si la touche gauche est appuyée
                        player.setVelocityX(-260); //alors vitesse négative en X
                        player.anims.play('left hammer', true); //et animation => gauche
                    }
                    else if (cursors.right.isDown) { //sinon si la touche droite est appuyée
                        player.setVelocityX(260); //alors vitesse positive en X
                        player.anims.play('right hammer', true); //et animation => droite
                    }
                    else if (cursors.space.isUp) { // sinon
                        player.setVelocityX(0); //vitesse nulle
                        player.anims.play('turn hammer'); //animation fait face caméra
                    }
                }
                if (cursors.up.isDown && player.body.touching.down) {//si touche haut appuyée ET que le perso touche le sol
                    player.setVelocityY(-330); //alors vitesse verticale négative
                    //(on saute)
                }
                if (cursors.space.isDown && player.body.touching.down && equipe == 'paladin sword') {
                    player.anims.play("paladin sword attack", true)
                    swordactive = true
                    attack

                    sword.x = player.x + 20;
                    sword.y = player.y - 10;
                }
                if (cursors.space.isDown && player.body.touching.down && equipe == 'paladin hammer') {
                    player.anims.play("paladin hammer attack", true)

                    hammer.anims.play("hammerattack", true)
                    hammeractive = true

                    hammer.x = player.x + 20
                    hammer.y = player.y - 70;
                }
                
                if (cursors.shift.isDown){
                    cursors.shift.reset()
                    cursors.shift.enable=false

                    if (equipe=="paladin sword"){
                        equipe="paladin hammer"
                        player.setTexture('paladin hammer')
                        setTimeout(()=>{
                            cursors.shift.enable=true
                        },1000)
                    }

                    else if (equipe=="paladin hammer"){
                        equipe="paladin sword"
                        player.setTexture('paladin sword')
                        setTimeout(()=>{
                            cursors.shift.enable=true
                        },1000)

                    }
                }

            }
            nextscene() {
                this.scene.start("level1")
            }

        }

        function attack(player) {
            this.player.anims.play('paladin sword attack' , true);
            detecterCollision();
            sword.setVisible(true);

        }
        function detecterCollision() {
            var colliders = this.physics.overlapRect(
                sword.x - sword.displayWidth / 2,
                sword.y - sword.displayHeight / 2,
                sword.displayWidth,
                sword.displayHeight
            );
        }

        function handleSwordCollision(swordCollider,ennemy) {
            ennemy.disableBody(true);
        }

        function handleHammerCollision(ennemy, hammerCollider) {
            ennemy.setVelocityX(80);
        }

        function handlePlayerEnnemyCollision(player, ennemy) {
            player.disableBody(true)
            gameover = true
        }
        function gravitysword(player, sword) {
            sword.body.setAllowGravity(false)
            sword.setVelocityY(0)
            sword.setVelocityX(0)
        }

        function attack(sword, ennemy) {
            if (swordactive == true) {
                ennemy.destroy()
            }
        }

        function hammerattack(hammer, ennemy) {
            if (hammeractive == true) {
                ennemy.destroy()
            }

        }

        function chockwave(hammer, Heavyennemy) {

            if (hammeractive == true) {
                Heavyennemy.setVelocityX(80)

            }
        }

        function gravityhammer(player, hammer) {
            hammer.body.setAllowGravity(false)
            hammer.setVelocityY(0)
            hammer.setVelocityX(0)
        }

        function chock(hammer, ennemy) {
            if (hammeractive == true) {
                ennemy.setVelocityX(80)
            }
        }

        function changeScenelevel1(player) {
            this.Scene.start('level1');
        }
//////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
/////////////////////    LEVEL 1 /////////////////////////////////////

        class level1 extends Phaser.Scene {
            constructor() {
                super('level1');
            }
            preload() {

                this.load.image('scene1', 'assets/Level1-Mariolike.png');
                this.load.image('ground', 'assets/platform.png');
                this.load.image('block', 'assets/caisse.png');
                this.load.spritesheet('paladin', 'assets/sprite-paladin_05.png',
                    { frameWidth: 250, frameHeight: 239 });
                this.load.spritesheet('ennemy', 'assets/ennemis.png',
                    { frameWidth: 360, frameHeight: 280 });
                this.load.spritesheet('Heavyennemy', 'assets/red-armor.png',
                    { frameWidth: 500, frameHeight: 600 });
                this.load.spritesheet('epée', 'assets/epée.png',
                    { frameWidth: 48, frameHeight: 48 });
                this.load.spritesheet('hammer', 'assets/hammer.png',
                    { frameWidth: 64, frameHeight: 64 });
                this.load.image('fond','assets/decors-proto.png');
                    
                

            }
            create() {
                this.physics.world.setBounds(0,0,4500,1603);
                porte = this.physics.add.sprite(4000, 3000, 'gjfio').setScale(2).setImmovable();
                balcon = this.physics.add.sprite(200, 200, 'balcon').setScale(2).setImmovable();
                balcon = this.physics.add.staticGroup();
                balcon.create(800,500,'balcon')



                this.add.image(400,400,'fond').setScale(6,2);
                platforms = this.physics.add.staticGroup();
                // (hauteur puis gauche droite)
                //////////// Sol //////////
                platforms.create(410, 1200, 'ground').setScale(2).refreshBody(); // plancher
                platforms.create(910, 1200, 'ground').setScale(2).refreshBody();
                platforms.create(1410, 1200, 'ground').setScale(2).refreshBody();
                platforms.create(1910, 1200, 'ground').setScale(2).refreshBody();
                platforms.create(2000,1200,'ground').setScale(2).refreshBody();
                platforms.create(2500,1200,'ground').setScale(2).refreshBody();
                platforms.create(3000,1200,'ground').setScale(2).refreshBody();
                platforms.create(3500,590,'ground').setScale(2).refreshBody();// changer de place
                platforms.create(4000,940,'ground').setScale(2).refreshBody();

                //////////// BALCON //////////
                platforms.create(1400,510,'ground').setScale(0.4).refreshBody();//balcon ok
                platforms.create(1782, 355, 'ground').setScale(0.4).refreshBody();//balcon ok
                platforms.create(1783, 755, 'ground').setScale(0.4).refreshBody();//balcon ok

                platforms.create(2675, 535, 'ground').setScale(0.4).refreshBody();//balcon ok
                platforms.create(3785, 640, 'ground').setScale(0.4).refreshBody();//balcon ok
                platforms.create(4193, 395, 'ground').setScale(0.4).refreshBody();//balcon ok
                platforms.create(4183, 800, 'ground').setScale(0.4).refreshBody();//balcon ok


                platforms.create(675, 250, 'ground');//changer de place

                platforms.create(1450,250,'ground');//
                platforms.create(1535,250,'ground');//
                platforms.create(1950,250,'ground');//
                platforms.create(2150,250,'ground');//
                platforms.create(2265,250,'ground');//
                platforms.create(3050,250,'ground');//


                block = this.physics.add.staticGroup();
                ///// à retirer apres test
                platforms.create(500,450,'ground');
                             
                //block.setImmovable(true);
                
                platforms.create(1500,200,'ground');
                platforms.create(2500,200,'ground');
                platforms.create(2000,200,'ground');
                platforms.create(1000,200,'ground');
            
                this.add.image(2250, 200, 'scene1').setScale(0.75);

                
                block.create(1350,845,'block').setScale(0.2).refreshBody();
                block.create(1350,755,'block').setScale(0.2).refreshBody();
                block = this.physics.add.image(350, 400);
                this.physics.add.collider(block, platforms);
                this.physics.add.collider(block, ennemy, null, this);
                this.physics.add.collider(block, player, null, this);
                this.physics.add.collider(block,block,null,this);
                block.setBounce(0.1);
                block.setCollideWorldBounds(false);
                block.allowGravity = true;
                block.setImmovable (true);

              
                player = this.physics.add.sprite(300, 200, 'paladin sword').setScale(0.75);

                

                player.setBounce(0.2);
                player.setCollideWorldBounds(true);
                this.physics.add.collider(player, platforms);
                this.physics.add.collider(porte,platforms);

                this.cameras.main.setBounds(0, 0, 5500, 3220);
                // ancrage de la caméra sur le joueur
                this.cameras.main.startFollow(player);
                cursors = this.input.keyboard.createCursorKeys()
                
                
                
                
                this.anims.create({
                    key: 'left sword',
                    frames: this.anims.generateFrameNumbers('paladin sword', { start: 10, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn sword',
                    frames: this.anims.generateFrameNumbers ('paladin sword', {start: 20, end : 21}) ,
                    frameRate: 20
                })

                this.anims.create({
                    key: 'right sword',
                    frames: this.anims.generateFrameNumbers('paladin sword', { start: 0, end: 9 }),
                    frameRate: 10,
                    repeat: -1
                });
                
                

                this.anims.create({
                    key: 'left hammer',
                    frames: this.anims.generateFrameNumbers('paladin hammer', { start: 0, end: 9 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn hammer',
                    frames: this.anims.generateFrameNumbers ('paladin hammer', {start: 20, end : 21}) ,
                    frameRate: 20
                })

                this.anims.create({
                    key: 'right hammer',
                    frames: this.anims.generateFrameNumbers('paladin hammer', { start: 10, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'space',
                    frames:this.anims.generateFrameNumbers('paladin hammer', {start:22, end:27}),
                    frameRate:10,
                    repeat:0
                
                })

                this.anims.create({
                    key: 'attack',
                    frames: this.anims.generateFrameNumbers('epée', { start: 0, end: 7 }),
                    frameRate: 10,
                    repeat: 0
                });
                this.anims.create({
                    key: 'paladin sword attack',
                    frames:this.anims.generateFrameNumbers('paladin sword', {start: 23, end:29}),
                    frameRate:10,
                    repeat:0
                })
                this.anims.create({
                    key: 'paladin hammer attack',
                    frames:this.anims.generateFrameNumbers('paladin hammer', {start: 23, end:28}),
                    frameRate:5,
                    repeat:0
                })
                this.anims.create({
                    key: 'hammerattack',
                    frames: this.anims.generateFrameNumbers('hammer', { start: 0, end: 8 }),
                    frameRate: 20,
                    repeat: 0
                });
                
                

                ennemy = this.physics.add.sprite(750, 400, 'ennemy').setScale(0.5);

                ennemy.setSize(250, 250, true);
                this.physics.add.collider(ennemy, platforms);
                this.physics.add.collider(player, ennemy, handlePlayerEnnemyCollision, null, this);
                ennemy.setBounce(0.5);
                ennemy.setCollideWorldBounds(true);
                ennemy.allowGravity = true;
                //this.ennemy.vivant=true

                Heavyennemy = this.physics.add.sprite(750, 400, 'Heavyennemy');

                this.physics.add.collider(Heavyennemy, platforms);
                this.physics.add.collider(player, Heavyennemy, null, this);
                Heavyennemy.setBounce(0.5);
                Heavyennemy.setCollideWorldBounds(true);

                Heavyennemy.allowGravity = true;

                lance = this.physics.add.sprite(350, 400);

                lance.setSize(120, 60, true);
                //lance.setOffsize(10,10,true);

                this.physics.add.collider(lance, platforms);
                this.physics.add.collider(player, ennemy, null, this);
                lance.setCollideWorldBounds(true);
                lance.setBounce(0.5);
                lance.setImmovable(true);
                lance.allowGravity = true

                //UTILISATION DE L'EPEE
                sword = this.physics.add.sprite(1000, 1000, 'epée');
                sword.setOrigin(0, 0);
                sword.setSize(200, 40);
                sword.setImmovable(true);
                swordColliders = this.physics.add.group();
                swordColliders.add(sword);
                this.physics.add.overlap(player, sword, gravitysword);
                this.physics.add.overlap(sword, ennemy, attack);
                this.physics.add.collider(ennemy, swordColliders, handleSwordCollision, null, this);
                attack = this.input.keyboard.addKey('space');
                this.physics.add.collider(sword, ennemy, attack);


                // UTILISATION DU MARTEAU
                hammer = this.physics.add.sprite(1000, 1000, 'hammer').setScale(2);
                hammer.setOrigin(0, 0);
                hammer.setSize(60, 40);
                hammer.setImmovable(true);
                hammerColliders = this.physics.add.group();
                hammerColliders.add(hammer);
                this.physics.add.overlap(player, hammer, gravityhammer);
                this.physics.add.collider(hammer, ennemy, chockwave);
                this.physics.add.collider(hammer, Heavyennemy, chock);
                this.physics.add.collider(ennemy, hammerColliders, handleHammerCollision, null, this);
                
                
                this.pointer=this.input.activePointer;

                this.physics.add.collider(porte,player,this.scene2,null, this);


            }
            update() {
                if (this.pointer.isDown){
                console.log(this.pointer.worldX,this.pointer.worldY)
                }

                porte.x=4500
                porte.y=0
                
                
                if (equipe == 'paladin sword') {
                    if (cursors.left.isDown) { //si la touche gauche est appuyée
                        player.setVelocityX(-260); //alors vitesse négative en X
                        player.anims.play('left sword', true); //et animation => gauche
                    }
                    else if (cursors.right.isDown) { //sinon si la touche droite est appuyée
                        player.setVelocityX(260); //alors vitesse positive en X
                        player.anims.play('right sword', true); //et animation => droite
                    }
                    else if (cursors.space.isUp) { // sinon
                        player.setVelocityX(0); //vitesse nulle
                        player.anims.play('turn sword'); //animation fait face caméra
                    }
                }
                if (equipe == 'paladin hammer') {
                    if (cursors.left.isDown) { //si la touche gauche est appuyée
                        player.setVelocityX(-260); //alors vitesse négative en X
                        player.anims.play('left hammer', true); //et animation => gauche
                    }
                    else if (cursors.right.isDown) { //sinon si la touche droite est appuyée
                        player.setVelocityX(260); //alors vitesse positive en X
                        player.anims.play('right hammer', true); //et animation => droite
                    }
                    else if (cursors.space.isUp) { // sinon
                        player.setVelocityX(0); //vitesse nulle
                        player.anims.play('turn hammer'); //animation fait face caméra
                    }
                }
                if (cursors.up.isDown && player.body.touching.down) {//si touche haut appuyée ET que le perso touche le sol
                    player.setVelocityY(-330); //alors vitesse verticale négative
                    //(on saute)
                }
                if (cursors.space.isDown && player.body.touching.down && equipe == 'paladin sword') {
                    player.anims.play("paladin sword attack", true)
                    swordactive = true
                    attack

                    sword.x = player.x + 20;
                    sword.y = player.y - 10;
                }
                if (cursors.space.isDown && player.body.touching.down && equipe == 'paladin hammer') {
                    player.anims.play("paladin hammer attack", true)

                    hammer.anims.play("hammerattack", true)
                    hammeractive = true

                    hammer.x = player.x + 20
                    hammer.y = player.y - 70;
                }
                
                if (cursors.shift.isDown){
                    cursors.shift.reset()
                    cursors.shift.enable=false

                    if (equipe=="paladin sword"){
                        equipe="paladin hammer"
                        player.setTexture('paladin hammer')
                        setTimeout(()=>{
                            cursors.shift.enable=true
                        },1000)
                    }

                    else if (equipe=="paladin hammer"){
                        equipe="paladin sword"
                        player.setTexture('paladin sword')
                        setTimeout(()=>{
                            cursors.shift.enable=true
                        },1000)

                    }
                }

            }
            scene2() {
                this.scene.start("level2")
            }

        }

////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////            LEVEL 2                 //////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////


        class level2 extends Phaser.Scene {
            constructor() {
                super('level2');
            }
            preload() {

                this.load.image('LVL2','assets/lv2 plan principal.png');
                this.load.image('Arche','assets/LV2 arche.png');
                this.load.spritesheet('perso', 'assets/perso.png',
                    { frameWidth: 32, frameHeight: 48 });
                this.load.spritesheet('paladin sword','assets/sprite-paladin_epee_01.png',
                    {frameWidth:250, frameHeight:236});
                this.load.spritesheet('paladin hammer','assets/sprite-paladin_marteau_01.png',
                    {frameWidth:260, frameHeight:236});
                
                this.load.spritesheet('ennemy', 'assets/ennemis.png',
                    { frameWidth: 360, frameHeight: 280 });
                this.load.spritesheet('Heavyennemy', 'assets/red-armor.png',
                    { frameWidth: 500, frameHeight: 600 });
                this.load.spritesheet('epée', 'assets/epée.png',
                    { frameWidth: 48, frameHeight: 48 });
                this.load.spritesheet('hammer', 'assets/hammer.png',
                    { frameWidth: 64, frameHeight: 64 });

            }
            create() {
                this.physics.world.setBounds(200,0,5000,2400);
                
                this.add.image(2600,1200,'LVL2').setScale(0.75)
                platforms = this.physics.add.staticGroup();
                // (hauteur puis gauche droite)
                platforms.create(410, 890, 'ground').setScale(2).refreshBody(); // plancher
                platforms.create(1100, 890, 'ground').setScale(2).refreshBody();
                platforms.create(1600, 890, 'ground').setScale(2).refreshBody();
                platforms.create(1200, 890, 'ground').setScale(2).refreshBody();
                platforms.create(500, 400, 'ground');
                platforms.create(150, 150, 'ground');
                platforms.create(750, 220, 'ground'); //en haut à droite
                //platforms.create(1200,600,'ground')
                platforms.create(700, 700, 'ground')



                porte = this.physics.add.sprite(3000, 3000, 'gjfio').setScale(2).setImmovable();
                
                
                
                //porte = this.allowGravity = false
                player = this.physics.add.sprite(300, -0, 'paladin sword').setScale(0.75);

                

                player.setBounce(0.2);
                player.setCollideWorldBounds(true);
                this.physics.add.collider(player, platforms);
                this.physics.add.collider(porte,platforms);

                this.cameras.main.setBounds(0, 0, 5500, 3220);
                // ancrage de la caméra sur le joueur
                this.cameras.main.startFollow(player);
                cursors = this.input.keyboard.createCursorKeys()
                this.physics.add.collider(player, porte, this.nextscene, null, this)
                
                
                
                this.anims.create({
                    key: 'left sword',
                    frames: this.anims.generateFrameNumbers('paladin sword', { start: 10, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn sword',
                    frames: this.anims.generateFrameNumbers ('paladin sword', {start: 20, end : 21}) ,
                    frameRate: 20
                })

                this.anims.create({
                    key: 'right sword',
                    frames: this.anims.generateFrameNumbers('paladin sword', { start: 0, end: 9 }),
                    frameRate: 10,
                    repeat: -1
                });
                
                

                this.anims.create({
                    key: 'left hammer',
                    frames: this.anims.generateFrameNumbers('paladin hammer', { start: 0, end: 9 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn hammer',
                    frames: this.anims.generateFrameNumbers ('paladin hammer', {start: 20, end : 21}) ,
                    frameRate: 20
                })

                this.anims.create({
                    key: 'right hammer',
                    frames: this.anims.generateFrameNumbers('paladin hammer', { start: 10, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'space',
                    frames:this.anims.generateFrameNumbers('paladin hammer', {start:22, end:27}),
                    frameRate:10,
                    repeat:0
                
                })

                this.anims.create({
                    key: 'attack',
                    frames: this.anims.generateFrameNumbers('epée', { start: 0, end: 7 }),
                    frameRate: 10,
                    repeat: 0
                });
                this.anims.create({
                    key: 'paladin sword attack',
                    frames:this.anims.generateFrameNumbers('paladin sword', {start: 23, end:29}),
                    frameRate:10,
                    repeat:0
                })
                this.anims.create({
                    key: 'paladin hammer attack',
                    frames:this.anims.generateFrameNumbers('paladin hammer', {start: 23, end:28}),
                    frameRate:5,
                    repeat:0
                })
                this.anims.create({
                    key: 'hammerattack',
                    frames: this.anims.generateFrameNumbers('hammer', { start: 0, end: 8 }),
                    frameRate: 20,
                    repeat: 0
                });
                
                

                ennemy = this.physics.add.sprite(750, 440, 'ennemy').setScale(0.5);

                ennemy.setSize(250, 250, true);
                this.physics.add.collider(ennemy, platforms);
                this.physics.add.collider(player, ennemy, handlePlayerEnnemyCollision, null, this);
                ennemy.setBounce(0.5);
                ennemy.setCollideWorldBounds(true);
                ennemy.allowGravity = true;
                //this.ennemy.vivant=true

                Heavyennemy = this.physics.add.sprite(750, 30, 'Heavyennemy');

                this.physics.add.collider(Heavyennemy, platforms);
                this.physics.add.collider(player, Heavyennemy, null, this);
                Heavyennemy.setBounce(0.5);
                Heavyennemy.setCollideWorldBounds(true);

                Heavyennemy.allowGravity = true;

                lance = this.physics.add.sprite(350, 400);

                lance.setSize(120, 60, true);
                //lance.setOffsize(10,10,true);

                this.physics.add.collider(lance, platforms);
                this.physics.add.collider(player, ennemy, null, this);
                lance.setCollideWorldBounds(true);
                lance.setBounce(0.5);
                lance.setImmovable(true);
                lance.allowGravity = true

                //UTILISATION DE L'EPEE
                sword = this.physics.add.sprite(1000, 1000, 'epée');
                sword.setOrigin(0, 0);
                sword.setSize(200, 40);
                sword.setImmovable(true);
                swordColliders = this.physics.add.group();
                swordColliders.add(sword);
                this.physics.add.overlap(player, sword, gravitysword);
                this.physics.add.overlap(sword, ennemy, attack);
                this.physics.add.collider(ennemy, swordColliders, handleSwordCollision, null, this);
                attack = this.input.keyboard.addKey('space');
                this.physics.add.collider(sword, ennemy, attack);


                // UTILISATION DU MARTEAU
                hammer = this.physics.add.sprite(1000, 1000, 'hammer').setScale(2);
                hammer.setOrigin(0, 0);
                hammer.setSize(60, 40);
                hammer.setImmovable(true);
                hammerColliders = this.physics.add.group();
                hammerColliders.add(hammer);
                this.physics.add.overlap(player, hammer, gravityhammer);
                this.physics.add.collider(hammer, ennemy, chockwave);
                this.physics.add.collider(hammer, Heavyennemy, chock);
                this.physics.add.collider(ennemy, hammerColliders, handleHammerCollision, null, this);
                attackhammer = this.input.keyboard.addKey('shift');


                this.pointer=this.input.activePointer;


            }
                

        
            update() {
                
                if (this.pointer.isDown){
                    console.log(this.pointer.worldX,this.pointer.worldY)
                    }

                porte.x=1500
                porte.y=500
                this.physics.add.collider(porte,platforms,null, this);
                if (equipe == 'paladin sword') {
                    if (cursors.left.isDown) { //si la touche gauche est appuyée
                        player.setVelocityX(-260); //alors vitesse négative en X
                        player.anims.play('left sword', true); //et animation => gauche
                    }
                    else if (cursors.right.isDown) { //sinon si la touche droite est appuyée
                        player.setVelocityX(260); //alors vitesse positive en X
                        player.anims.play('right sword', true); //et animation => droite
                    }
                    else if (cursors.space.isUp) { // sinon
                        player.setVelocityX(0); //vitesse nulle
                        player.anims.play('turn sword'); //animation fait face caméra
                    }
                }
                if (equipe == 'paladin hammer') {
                    if (cursors.left.isDown) { //si la touche gauche est appuyée
                        player.setVelocityX(-260); //alors vitesse négative en X
                        player.anims.play('left hammer', true); //et animation => gauche
                    }
                    else if (cursors.right.isDown) { //sinon si la touche droite est appuyée
                        player.setVelocityX(260); //alors vitesse positive en X
                        player.anims.play('right hammer', true); //et animation => droite
                    }
                    else if (cursors.space.isUp) { // sinon
                        player.setVelocityX(0); //vitesse nulle
                        player.anims.play('turn hammer'); //animation fait face caméra
                    }
                }
                if (cursors.up.isDown && player.body.touching.down) {//si touche haut appuyée ET que le perso touche le sol
                    player.setVelocityY(-330); //alors vitesse verticale négative
                    //(on saute)
                }
                if (cursors.space.isDown && player.body.touching.down && equipe == 'paladin sword') {
                    player.anims.play("paladin sword attack", true)
                    swordactive = true
                    attack

                    sword.x = player.x + 20;
                    sword.y = player.y - 10;
                }
                if (cursors.space.isDown && player.body.touching.down && equipe == 'paladin hammer') {
                    player.anims.play("paladin hammer attack", true)

                    hammer.anims.play("hammerattack", true)
                    hammeractive = true

                    hammer.x = player.x + 20
                    hammer.y = player.y - 70;
                }
                
                if (cursors.shift.isDown){
                    cursors.shift.reset()
                    cursors.shift.enable=false

                    if (equipe=="paladin sword"){
                        equipe="paladin hammer"
                        player.setTexture('paladin hammer')
                        setTimeout(()=>{
                            cursors.shift.enable=true
                        },1000)
                    }

                    else if (equipe=="paladin hammer"){
                        equipe="paladin sword"
                        player.setTexture('paladin sword')
                        setTimeout(()=>{
                            cursors.shift.enable=true
                        },1000)

                    }
                }

            }
            nextscene() {
                this.scene.start("level1")
            }

        }

            
        
        class level3 extends Phaser.Scene {
            constructor() {
                super('level3');
            }
            preload() {

            }
            create() {

            }
            update() {

            }
        }


        var config = {
            type: Phaser.AUTO,
            width: 1600, height: 900,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 200 },
                    debug: true
                }
            },
            scene: [title, tuto,level1,level2,level3]

        }; new Phaser.Game(config);
    </script>
</body>

</html>