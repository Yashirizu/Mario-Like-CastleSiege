<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Castle-Siege</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>


<body>
    <script type="text/javascript">

        class title extends Phaser.Scene {
            constructor() {
                super("intro");
            }

            preload() {
                this.load.image('intro', 'assets/LOGO.png');
            }
            create() {
                this.image = this.add.image(700, 400, 'intro').setScale(1);
                this.image.setInteractive()

                this.image.on('pointerdown', this.onImageClicked, this);
            }
            update() {



            }
            onImageClicked() {
                this.scene.start('tuto')
            }
        }
        var cursors
        var platforms;
        var player;
        var ennemy;
        var gameover = false;
        var Heavyennemy;
        var lance;
        var clavier;
        var sword;
        var marteau;
        var hammer;
        var hammerColliders;
        var hammeractive = false
        var swordColliders;
        var swordactive = false
        var attackhammer;
        var porte;
        var caisse;
        var balcon;
        var equipe = 'paladin sword';
        var distance
        

        class tuto extends Phaser.Scene {500
            constructor() {
                super('tuto');
            }
            preload() {
                this.load.image('chapelle', 'assets/chapelle.png');
                this.load.image('decors-proto', 'assets/decors-proto.png');
                this.load.image('sky', 'assets/sky.png');
                this.load.image('ground', 'assets/platform.png');

                this.load.spritesheet('perso', 'assets/perso.png',
                    { frameWidth: 32, frameHeight: 48 });

                this.load.spritesheet('paladin sword','assets/sprite-paladin_epee_01.png',
                    {frameWidth:250, frameHeight:236});

                this.load.spritesheet('paladin hammer','assets/sprite-paladin_marteau_01.png',
                    {frameWidth:260, frameHeight:236});
                
                this.load.spritesheet('ennemy', 'assets/Oeil.png',
                    { frameWidth: 800, frameHeight: 600 });

                this.load.spritesheet('Heavyennemy', 'assets/troll.png',
                    { frameWidth: 500, frameHeight: 550 });

                this.load.spritesheet('epée', 'assets/epée.png',
                    { frameWidth: 48, frameHeight: 48 });
                    
                this.load.spritesheet('hammer', 'assets/hammer.png',
                    { frameWidth: 64, frameHeight: 64 });
                

            }
            create() {


                platforms = this.physics.add.staticGroup();
                // (hauteur puis gauche droite)
                platforms.create(410, 890, 'ground').setScale(2).refreshBody(); // plancher
                platforms.create(1100, 890, 'ground').setScale(2).refreshBody();
                platforms.create(1600, 890, 'ground').setScale(2).refreshBody();
                platforms.create(1200, 890, 'ground').setScale(2).refreshBody();
                platforms.create(500, 400, 'ground');
                platforms.create(50, 150, 'ground');
                platforms.create(750, 220, 'ground'); //en haut à droite
                //platforms.create(1200,600,'ground')
                //platforms.create(700, 700, 'ground')



                porte = this.physics.add.sprite(3000, 3000, 'gjfio').setScale(2).setImmovable();
                this.add.image(100, 250, 'chapelle').setScale(1); // à mettre après les plateformes pour cacher les platforme derrière le décors
                
                
                //porte = this.allowGravity = false
                player = this.physics.add.sprite(300, 700, 'paladin sword').setScale(0.75);

                

                player.setBounce(0.2);
                player.setCollideWorldBounds(true);
                this.physics.add.collider(player, platforms);
                this.physics.add.collider(porte,platforms);

                this.cameras.main.setBounds(0, 0, 5500, 3220);
                // ancrage de la caméra sur le joueur
                this.cameras.main.startFollow(player);
                cursors = this.input.keyboard.createCursorKeys()
                this.physics.add.collider(player, porte, this.nextscene, null, this)
                
                
                
                this.anims.create({
                    key: 'left sword',
                    frames: this.anims.generateFrameNumbers('paladin sword', { start: 10, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn sword',
                    frames: this.anims.generateFrameNumbers ('paladin sword', {start: 20, end : 21}) ,
                    frameRate: 20
                })

                this.anims.create({
                    key: 'right sword',
                    frames: this.anims.generateFrameNumbers('paladin sword', { start: 0, end: 9 }),
                    frameRate: 10,
                    repeat: -1
                });
                
                

                this.anims.create({
                    key: 'left hammer',
                    frames: this.anims.generateFrameNumbers('paladin hammer', { start: 0, end: 9 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn hammer',
                    frames: this.anims.generateFrameNumbers ('paladin hammer', {start: 20, end : 21}) ,
                    frameRate: 20
                })

                this.anims.create({
                    key: 'right hammer',
                    frames: this.anims.generateFrameNumbers('paladin hammer', { start: 10, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'space',
                    frames:this.anims.generateFrameNumbers('paladin hammer', {start:22, end:27}),
                    frameRate:10,
                    repeat:0
                
                })

                this.anims.create({
                    key: 'attack',
                    frames: this.anims.generateFrameNumbers('epée', { start: 0, end: 7 }),
                    frameRate: 10,
                    repeat: 0
                });
                this.anims.create({
                    key: 'paladin sword attack',
                    frames:this.anims.generateFrameNumbers('paladin sword', {start: 23, end:29}),
                    frameRate:10,
                    repeat:0
                })
                this.anims.create({
                    key: 'paladin hammer attack',
                    frames:this.anims.generateFrameNumbers('paladin hammer', {start: 23, end:28}),
                    frameRate:5,
                    repeat:0
                })
                this.anims.create({
                    key: 'hammerattack',
                    frames: this.anims.generateFrameNumbers('hammer', { start: 0, end: 8 }),
                    frameRate: 20,
                    repeat: 0
                });
                
                

                ennemy = this.physics.add.sprite(750, 440, 'ennemy').setScale(0.3);

                ennemy.setSize(550,500, true);
                this.physics.add.collider(ennemy, platforms);
                this.physics.add.collider(player, ennemy, handlePlayerEnnemyCollision, null, this);
                ennemy.setBounce(0.5);
                ennemy.setCollideWorldBounds(true);
                ennemy.allowGravity = true;
                //this.ennemy.vivant=true

                Heavyennemy = this.physics.add.sprite(750, 30, 'Heavyennemy');

                this.physics.add.collider(Heavyennemy, platforms);
                this.physics.add.collider(player, Heavyennemy, null, this);
                Heavyennemy.setBounce(0.5);
                Heavyennemy.setCollideWorldBounds(true);

                Heavyennemy.allowGravity = true;

                lance = this.physics.add.sprite(350, 400);

                lance.setSize(120, 60, true);
                //lance.setOffsize(10,10,true);

                this.physics.add.collider(lance, platforms);
                this.physics.add.collider(player, ennemy, null, this);
                lance.setCollideWorldBounds(true);
                lance.setBounce(0.5);
                lance.setImmovable(true);
                lance.allowGravity = true

                //UTILISATION DE L'EPEE
                sword = this.physics.add.sprite(1000, 1000, 'epée');
                sword.setOrigin(0, 0);
                sword.setSize(200, 40);
                sword.setImmovable(true);
                swordColliders = this.physics.add.group();
                swordColliders.add(sword);
                this.physics.add.overlap(player, sword, gravitysword);
                this.physics.add.overlap(sword, ennemy, attack);
                this.physics.add.collider(ennemy, swordColliders, handleSwordCollision, null, this);
                attack = this.input.keyboard.addKey('space');
                this.physics.add.collider(sword, ennemy, attack);


                // UTILISATION DU MARTEAU
                hammer = this.physics.add.sprite(1000, 1000, 'hammer').setScale(2);
                hammer.setOrigin(0, 0);
                hammer.setSize(60, 40);
                hammer.setImmovable(true);
                hammerColliders = this.physics.add.group();
                hammerColliders.add(hammer);
                this.physics.add.overlap(player, hammer, gravityhammer);
                this.physics.add.collider(hammer, ennemy, chockwave);
                this.physics.add.collider(hammer, Heavyennemy, chock);
                this.physics.add.collider(ennemy, hammerColliders, handleHammerCollision, null, this);
                attackhammer = this.input.keyboard.addKey('shift');



            }
            update() {
                porte.x=1500
                porte.y=500
                this.physics.add.collider(porte,platforms,null, this);
                if (equipe == 'paladin sword') {
                    if (cursors.left.isDown) { //si la touche gauche est appuyée
                        player.setVelocityX(-260); //alors vitesse négative en X
                        player.anims.play('left sword', true); //et animation => gauche
                    }
                    else if (cursors.right.isDown) { //sinon si la touche droite est appuyée
                        player.setVelocityX(260); //alors vitesse positive en X
                        player.anims.play('right sword', true); //et animation => droite
                    }
                    else if (cursors.space.isUp) { // sinon
                        player.setVelocityX(0); //vitesse nulle
                        player.anims.play('turn sword'); //animation fait face caméra
                    }
                }
                if (equipe == 'paladin hammer') {
                    if (cursors.left.isDown) { //si la touche gauche est appuyée
                        player.setVelocityX(-260); //alors vitesse négative en X
                        player.anims.play('left hammer', true); //et animation => gauche
                    }
                    else if (cursors.right.isDown) { //sinon si la touche droite est appuyée
                        player.setVelocityX(260); //alors vitesse positive en X
                        player.anims.play('right hammer', true); //et animation => droite
                    }
                    else if (cursors.space.isUp) { // sinon
                        player.setVelocityX(0); //vitesse nulle
                        player.anims.play('turn hammer'); //animation fait face caméra
                    }
                }
                if (cursors.up.isDown && player.body.touching.down) {//si touche haut appuyée ET que le perso touche le sol
                    player.setVelocityY(-330); //alors vitesse verticale négative
                    //(on saute)
                }
                if (cursors.space.isDown && player.body.touching.down && equipe == 'paladin sword') {
                    player.anims.play("paladin sword attack", true)
                    swordactive = true
                    attack

                    sword.x = player.x + 20;
                    sword.y = player.y - 10;
                }
                if (cursors.space.isDown && player.body.touching.down && equipe == 'paladin hammer') {
                    player.anims.play("paladin hammer attack", true)

                    hammer.anims.play("hammerattack", true)
                    hammeractive = true

                    hammer.x = player.x + 20
                    hammer.y = player.y - 70;
                }
                
                if (cursors.shift.isDown){
                    cursors.shift.reset()
                    cursors.shift.enable=false

                    if (equipe=="paladin sword"){
                        equipe="paladin hammer"
                        player.setTexture('paladin hammer')
                        setTimeout(()=>{
                            cursors.shift.enable=true
                        },1000)
                    }

                    else if (equipe=="paladin hammer"){
                        equipe="paladin sword"
                        player.setTexture('paladin sword')
                        setTimeout(()=>{
                            cursors.shift.enable=true
                        },1000)

                    }
                }

            }
            nextscene() {
                this.scene.start("level1")
            }

        }

        function attack(player) {
            this.player.anims.play('paladin sword attack' , true);
            detecterCollision();
            sword.setVisible(true);

        }
        function detecterCollision() {
            var colliders = this.physics.overlapRect(
                sword.x - sword.displayWidth / 2,
                sword.y - sword.displayHeight / 2,
                sword.displayWidth,
                sword.displayHeight
            );
        }

        function handleSwordCollision(swordCollider,ennemy) {
            ennemy.disableBody(true);
        }

        function handleHammerCollision(ennemy, hammerCollider) {
            ennemy.setVelocityX(80);
        }

        function handlePlayerEnnemyCollision(player, ennemy) {
            player.disableBody(true)
            gameover = true
        }
        function gravitysword(player, sword) {
            sword.body.setAllowGravity(false)
            sword.setVelocityY(0)
            sword.setVelocityX(0)
        }

        function attack(sword, ennemy) {
            if (swordactive == true) {
                ennemy.destroy()
            }
        }

        function hammerattack(hammer, ennemy) {
            if (hammeractive == true) {
                ennemy.destroy()
            }

        }

        function chockwave(hammer, Heavyennemy) {

            if (hammeractive == true) {
                Heavyennemy.setVelocityX(80)

            }
        }

        function gravityhammer(player, hammer) {
            hammer.body.setAllowGravity(false)
            hammer.setVelocityY(0)
            hammer.setVelocityX(0)
        }

        function chock(hammer, ennemy) {
            if (hammeractive == true) {
                ennemy.setVelocityX(80)
            }
        }

        function changeScenelevel1(player) {
            this.Scene.start('level1');
        }
//////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
/////////////////////      LEVEL 1     ///////////////////////////////
//////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////

        class level1 extends Phaser.Scene {
            constructor() {
                super('level1');
            }
            preload() {

                this.load.image('scene1', 'assets/Level1-Mariolike.png');
                this.load.image('ground', 'assets/platform.png');
                this.load.image('caisse', 'assets/caisse.png');
                this.load.spritesheet('paladin', 'assets/sprite-paladin_05.png',
                    { frameWidth: 250, frameHeight: 239 });
                this.load.spritesheet('ennemy', 'assets/Oeil.png',
                    {frameWidth: 800, frameHeight: 600 });
                this.load.spritesheet('Heavyennemy', 'assets/red-troll.png',
                    { frameWidth: 500, frameHeight: 550 });
                this.load.spritesheet('epée', 'assets/epée.png',
                    { frameWidth: 48, frameHeight: 48 });
                this.load.spritesheet('hammer', 'assets/hammer.png',
                    { frameWidth: 64, frameHeight: 64 });
                this.load.image('fond','assets/decors-proto.png');
                    
                

            }
            create() {
                this.physics.world.setBounds(0,0,4500,1603);
                porte = this.physics.add.sprite(4000, 3000, 'gjfio').setScale(2).setImmovable();
                balcon = this.physics.add.sprite(200, 200, 'balcon').setScale(2).setImmovable();
                balcon = this.physics.add.staticGroup();
                balcon.create(800,500,'balcon')



                this.add.image(400,400,'fond').setScale(6,2);

                platforms = this.physics.add.staticGroup();
                

                //////////// Sol //////////
                platforms.create(410, 1200, 'ground').setScale(2).refreshBody();// plancher
                platforms.create(910, 1200, 'ground').setScale(2).refreshBody();//plancher
                platforms.create(1410, 1200,'ground').setScale(2).refreshBody();//plancher
                platforms.create(1910, 1200,'ground').setScale(2).refreshBody();//plancher
                platforms.create(2000,1200,'ground').setScale(2).refreshBody();//plancher
                platforms.create(2500,1200,'ground').setScale(2).refreshBody();//plancher
                platforms.create(3000,1200,'ground').setScale(2).refreshBody();//plancher
                platforms.create(3500,1200,'ground').setScale(2).refreshBody();//plancher
                platforms.create(4000,1200,'ground').setScale(2).refreshBody();//plancher
                


                //////////// Toits //////////

                platforms.create(1010,200,'ground').setScale(1.4).refreshBody();// maison 1 (toit)
                platforms.create(1010,250,'ground').setScale(1.6).refreshBody();// maison 1

                platforms.create(2200,210,'ground').setScale(1.6).refreshBody();// Maison 2 (toit)
                platforms.create(2225,260,'ground').setScale(1.8).refreshBody();//
                platforms.create(2250,210,'ground').setScale(1.6).refreshBody();// 
                platforms.create(2250,260,'ground').setScale(1.8).refreshBody();//

                platforms.create(3300,200,'ground').setScale(1.6).refreshBody();// Maison 3 (toit)
                platforms.create(3300,250,'ground').setScale(1.8).refreshBody();//
                platforms.create(3350,200,'ground').setScale(1.6).refreshBody();// 
                platforms.create(3350,250,'ground').setScale(1.8).refreshBody();//

                platforms.create(4640,200,'ground').setScale(1.6).refreshBody();// Maison 4 (oit)
                platforms.create(4610,250,'ground').setScale(1.8).refreshBody();//

                
                //////////// BALCON //////////
                platforms.create(1400,510,'ground').setScale(0.4).refreshBody();//balcon ok
                platforms.create(1782, 355, 'ground').setScale(0.4).refreshBody();//balcon ok
                platforms.create(1783, 755, 'ground').setScale(0.4).refreshBody();//balcon ok

                platforms.create(2675, 535, 'ground').setScale(0.4).refreshBody();//balcon ok
                platforms.create(3785, 640, 'ground').setScale(0.4).refreshBody();//balcon ok
                platforms.create(4193, 395, 'ground').setScale(0.4).refreshBody();//balcon ok
                platforms.create(4183, 800, 'ground').setScale(0.4).refreshBody();//balcon ok
                platforms.create(1407, 929, 'ground').setScale(0.4).refreshBody();//balcon ok
                platforms.create(2675,940, 'ground').setScale(0.4).refreshBody();// balcon ok
                
                ///// à retirer apres test

                platforms.create(400,350,'ground');                       
                                
                caisse = this.physics.add.staticGroup();
                caisse.create(2200, 900, 'caisse').setScale(1).refreshBody();// blocage maison
                caisse.create(2200, 400, 'caisse').setScale(1).refreshBody();


                this.add.image(2250, 200, 'scene1').setScale(0.75);

                //////////// Caisse //////////

                
                
                
                
                caisse.create(1910, 1060, 'caisse').setScale(0.2).refreshBody();
                caisse.create(1910, 1150, 'caisse').setScale(0.2).refreshBody();
                // TEST //
                caisse.create(1910, 980, 'caisse').setScale(0.2).refreshBody();
                caisse.create(1910, 900, 'caisse').setScale(0.2).refreshBody();

                caisse.create(3900,1100,'caisse').setScale(0.2).refreshBody();
                

              
                player = this.physics.add.sprite(300, 950, 'paladin sword').setScale(0.75);             

                player.setBounce(0.2);
                player.setCollideWorldBounds(true);
                this.physics.add.collider(player, platforms);
                this.physics.add.collider(player,caisse);


                this.physics.add.collider(porte,platforms);
                

                this.cameras.main.setBounds(0, 0, 5500, 3220);
                // ancrage de la caméra sur le joueur
                this.cameras.main.startFollow(player);
                cursors = this.input.keyboard.createCursorKeys()
                
                
                
                
                this.anims.create({
                    key: 'left sword',
                    frames: this.anims.generateFrameNumbers('paladin sword', { start: 10, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn sword',
                    frames: this.anims.generateFrameNumbers ('paladin sword', {start: 20, end : 21}) ,
                    frameRate: 20
                })

                this.anims.create({
                    key: 'right sword',
                    frames: this.anims.generateFrameNumbers('paladin sword', { start: 0, end: 9 }),
                    frameRate: 10,
                    repeat: -1
                });
                
                

                this.anims.create({
                    key: 'left hammer',
                    frames: this.anims.generateFrameNumbers('paladin hammer', { start: 0, end: 9 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn hammer',
                    frames: this.anims.generateFrameNumbers ('paladin hammer', {start: 20, end : 21}) ,
                    frameRate: 20
                })

                this.anims.create({
                    key: 'right hammer',
                    frames: this.anims.generateFrameNumbers('paladin hammer', { start: 10, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'space',
                    frames:this.anims.generateFrameNumbers('paladin hammer', {start:22, end:27}),
                    frameRate:10,
                    repeat:0
                
                })

                this.anims.create({
                    key: 'attack',
                    frames: this.anims.generateFrameNumbers('epée', { start: 0, end: 7 }),
                    frameRate: 10,
                    repeat: 0
                });
                this.anims.create({
                    key: 'paladin sword attack',
                    frames:this.anims.generateFrameNumbers('paladin sword', {start: 23, end:29}),
                    frameRate:10,
                    repeat:0
                })
                this.anims.create({
                    key: 'paladin hammer attack',
                    frames:this.anims.generateFrameNumbers('paladin hammer', {start: 23, end:28}),
                    frameRate:5,
                    repeat:0
                })
                this.anims.create({
                    key: 'hammerattack',
                    frames: this.anims.generateFrameNumbers('hammer', { start: 0, end: 8 }),
                    frameRate: 20,
                    repeat: 0
                });
                
                

                ennemy = this.physics.add.sprite(250, 200, 'ennemy').setScale(0.2);

                ennemy.setSize(550, 550, true);
                this.physics.add.collider(ennemy, platforms);
                this.physics.add.collider(player, ennemy, handlePlayerEnnemyCollision, null, this);
                ennemy.setBounce(0.5);
                ennemy.setCollideWorldBounds(true);
                ennemy.allowGravity = true;
                //this.ennemy.vivant=true

                Heavyennemy = this.physics.add.sprite(250, 200, 'Heavyennemy');

                this.physics.add.collider(Heavyennemy, platforms);
                this.physics.add.collider(player, Heavyennemy, null, this);
                Heavyennemy.setBounce(0.5);
                Heavyennemy.setCollideWorldBounds(true);

                Heavyennemy.allowGravity = true;

                lance = this.physics.add.sprite(350, 400);

                lance.setSize(120, 60, true);
                //lance.setOffsize(10,10,true);

                this.physics.add.collider(lance, platforms);
                this.physics.add.collider(player, ennemy, null, this);
                lance.setCollideWorldBounds(true);
                lance.setBounce(0.5);
                lance.setImmovable(true);
                lance.allowGravity = true

                //UTILISATION DE L'EPEE
                sword = this.physics.add.sprite(1000, 1000, 'epée');
                sword.setOrigin(0, 0);
                sword.setSize(200, 40);
                sword.setImmovable(true);
                swordColliders = this.physics.add.group();
                swordColliders.add(sword);
                this.physics.add.overlap(player, sword, gravitysword);
                this.physics.add.overlap(sword, ennemy, attack);
                this.physics.add.collider(ennemy, swordColliders, handleSwordCollision, null, this);
                attack = this.input.keyboard.addKey('space');
                this.physics.add.collider(sword, ennemy, attack);


                // UTILISATION DU MARTEAU
                hammer = this.physics.add.sprite(1000, 1000, 'hammer').setScale(2);
                hammer.setOrigin(0, 0);
                hammer.setSize(60, 40);
                hammer.setImmovable(true);
                hammerColliders = this.physics.add.group();
                hammerColliders.add(hammer);
                this.physics.add.overlap(player, hammer, gravityhammer);
                this.physics.add.collider(hammer, ennemy, chockwave);
                this.physics.add.collider(hammer, Heavyennemy, chock);
                this.physics.add.collider(ennemy, hammerColliders, handleHammerCollision, null, this);
                
                
                this.pointer=this.input.activePointer;

                this.physics.add.collider(porte,player,this.scene2,null, this);


            }
            update() {
                if (this.pointer.isDown){
                console.log(this.pointer.worldX,this.pointer.worldY)
                }

                porte.x=4500
                porte.y=0
                
                
                if (equipe == 'paladin sword') {
                    if (cursors.left.isDown) { //si la touche gauche est appuyée
                        player.setVelocityX(-260); //alors vitesse négative en X
                        player.anims.play('left sword', true); //et animation => gauche
                    }
                    else if (cursors.right.isDown) { //sinon si la touche droite est appuyée
                        player.setVelocityX(260); //alors vitesse positive en X
                        player.anims.play('right sword', true); //et animation => droite
                    }
                    else if (cursors.space.isUp) { // sinon
                        player.setVelocityX(0); //vitesse nulle
                        player.anims.play('turn sword'); //animation fait face caméra
                    }
                }
                if (equipe == 'paladin hammer') {
                    if (cursors.left.isDown) { //si la touche gauche est appuyée
                        player.setVelocityX(-260); //alors vitesse négative en X
                        player.anims.play('left hammer', true); //et animation => gauche
                    }
                    else if (cursors.right.isDown) { //sinon si la touche droite est appuyée
                        player.setVelocityX(260); //alors vitesse positive en X
                        player.anims.play('right hammer', true); //et animation => droite
                    }
                    else if (cursors.space.isUp) { // sinon
                        player.setVelocityX(0); //vitesse nulle
                        player.anims.play('turn hammer'); //animation fait face caméra
                    }
                }
                if (cursors.up.isDown && player.body.touching.down) {//si touche haut appuyée ET que le perso touche le sol
                    player.setVelocityY(-330); //alors vitesse verticale négative
                    //(on saute)
                }
                if (cursors.space.isDown && player.body.touching.down && equipe == 'paladin sword') {
                    player.anims.play("paladin sword attack", true)
                    swordactive = true
                    attack

                    sword.x = player.x + 20;
                    sword.y = player.y - 10;
                }
                if (cursors.space.isDown && player.body.touching.down && equipe == 'paladin hammer') {
                    player.anims.play("paladin hammer attack", true)

                    hammer.anims.play("hammerattack", true)
                    hammeractive = true

                    hammer.x = player.x + 20
                    hammer.y = player.y - 70;
                }
                
                if (cursors.shift.isDown){
                    cursors.shift.reset()
                    cursors.shift.enable=false

                    if (equipe=="paladin sword"){
                        equipe="paladin hammer"
                        player.setTexture('paladin hammer')
                        setTimeout(()=>{
                            cursors.shift.enable=true
                        },1000)
                    }

                    else if (equipe=="paladin hammer"){
                        equipe="paladin sword"
                        player.setTexture('paladin sword')
                        setTimeout(()=>{
                            cursors.shift.enable=true
                        },1000)

                    }
                }

            }
            scene2() {
                this.scene.start("level2")
            }

        }

////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////            LEVEL 2                 //////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////


        class level2 extends Phaser.Scene {
            constructor() {
                super('level2');
            }
            preload() {

                this.load.image('LVL2','assets/lv2 plan principal.png');
                this.load.image('Arche','assets/LV2 arche.png');
                this.load.image('ground','assets/platform.png');
                this.load.image('caisse','assets/caisse.png');

                this.load.spritesheet('perso', 'assets/perso.png',
                    { frameWidth: 32, frameHeight: 48 });
                this.load.spritesheet('paladin sword','assets/sprite-paladin_epee_01.png',
                    {frameWidth:250, frameHeight:236});
                this.load.spritesheet('paladin hammer','assets/sprite-paladin_marteau_01.png',
                    {frameWidth:260, frameHeight:236});                
                this.load.spritesheet('ennemy', 'assets/Oeil.png',
                    { frameWidth: 800, frameHeight: 600 });
                this.load.spritesheet('Heavyennemy', 'assets/troll.png',
                    { frameWidth: 500, frameHeight: 550 });
                this.load.spritesheet('epée', 'assets/epée.png',
                    { frameWidth: 48, frameHeight: 48 });
                this.load.spritesheet('hammer', 'assets/hammer.png',
                    { frameWidth: 64, frameHeight: 64 });

            }
            create() {
                this.physics.world.setBounds(200,0,4800,2400);

                caisse= this.physics.add.staticGroup();

                caisse.create(3845,990,'caisse').setScale(1.5).refreshBody()
                caisse.create(4100,570,'caisse').setScale(0.6).refreshBody()

                this.add.image(2600,1200,'LVL2').setScale(0.75)
                
                ///////////////////     SOL DU NIVEAU    ////////////////////
                platforms= this.physics.add.staticGroup();
                platforms.create(600, 2400, 'ground').setScale(2).refreshBody(); // plancher
                platforms.create(1400, 2400, 'ground').setScale(2).refreshBody();
                platforms.create(2100, 2400, 'ground').setScale(2).refreshBody();
                platforms.create(2800, 2400, 'ground').setScale(2).refreshBody()
                platforms.create(3500, 2400, 'ground').setScale(2).refreshBody();
                platforms.create(4200, 2400, 'ground').setScale(2).refreshBody();
                platforms.create(4900, 2400, 'ground').setScale(2).refreshBody();
                ///////////////     Batiment Gauche      //////////////////////
                platforms.create(750,500, 'ground').setScale(2.5).refreshBody(); // (toit)
                platforms.create(750,890, 'ground').setScale(2.5).refreshBody(); // (2e étage)
                platforms.create(750,1390, 'ground').setScale(2.5).refreshBody();// (1er étage)
                platforms.create(750,1790, 'ground').setScale(2.5).refreshBody();// (RDC)
                //////////////      BATIMENT CENTRAL      ////////////////////

                platforms.create(2650,890, 'ground').setScale(2.5).refreshBody(); // (toit)
                platforms.create(2950,890, 'ground').setScale(2.5).refreshBody();

                platforms.create(2350,1290, 'ground').setScale(2.5).refreshBody(); // (1er étage)
                platforms.create(2650,1290, 'ground').setScale(2.5).refreshBody();


                platforms.create(2650,1700, 'ground').setScale(4).refreshBody(); // RDC

                /////////////////////   CAISSE   /////////////////////////////////
                
                caisse.create(1700,2250,'caisse').setScale(0.2).refreshBody() // (pile de droite)
                caisse.create(1700,2160,'caisse').setScale(0.2).refreshBody()
                caisse.create(1700,2080,'caisse').setScale(0.2).refreshBody()
                caisse.create(1700,2000,'caisse').setScale(0.2).refreshBody()

                caisse.create(1580,2250,'caisse').setScale(0.2).refreshBody() // (pile du milieu)
                caisse.create(1580,2160,'caisse').setScale(0.2).refreshBody()
                caisse.create(1580,2080,'caisse').setScale(0.2).refreshBody()

                caisse.create(1380,2250,'caisse').setScale(0.2).refreshBody() // (caisse de gauche)

                caisse.create(3400,1600,'caisse').setScale(0.2).refreshBody()
                caisse.create(3400,1520,'caisse').setScale(0.2).refreshBody()

                caisse.create(1900,1200,'caisse').setScale(0.2).refreshBody()
                caisse.create(1900,1120,'caisse').setScale(0.2).refreshBody()
                


                porte = this.physics.add.sprite(4000, 4000, 'gjfio').setScale(2).setImmovable();
                
                
                
                //porte = this.allowGravity = false
                player = this.physics.add.sprite(300, -0, 'paladin sword').setScale(0.75);

                

                player.setBounce(0.2);
                player.setCollideWorldBounds(true);
                this.physics.add.collider(player, platforms);
                this.physics.add.collider(porte,platforms);
                this.physics.add.collider(player,caisse);

                this.cameras.main.setBounds(0, 0, 5500, 3220);
                // ancrage de la caméra sur le joueur
                this.cameras.main.startFollow(player);
                cursors = this.input.keyboard.createCursorKeys()
                this.physics.add.collider(player, porte, this.nextscene, null, this)
                
                
                
                this.anims.create({
                    key: 'left sword',
                    frames: this.anims.generateFrameNumbers('paladin sword', { start: 10, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn sword',
                    frames: this.anims.generateFrameNumbers ('paladin sword', {start: 20, end : 21}) ,
                    frameRate: 20
                })

                this.anims.create({
                    key: 'right sword',
                    frames: this.anims.generateFrameNumbers('paladin sword', { start: 0, end: 9 }),
                    frameRate: 10,
                    repeat: -1
                });
                
                

                this.anims.create({
                    key: 'left hammer',
                    frames: this.anims.generateFrameNumbers('paladin hammer', { start: 0, end: 9 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn hammer',
                    frames: this.anims.generateFrameNumbers ('paladin hammer', {start: 20, end : 21}) ,
                    frameRate: 20
                })

                this.anims.create({
                    key: 'right hammer',
                    frames: this.anims.generateFrameNumbers('paladin hammer', { start: 10, end: 19 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'space',
                    frames:this.anims.generateFrameNumbers('paladin hammer', {start:22, end:27}),
                    frameRate:10,
                    repeat:0
                
                })

                this.anims.create({
                    key: 'attack',
                    frames: this.anims.generateFrameNumbers('epée', { start: 0, end: 7 }),
                    frameRate: 10,
                    repeat: 0
                });
                this.anims.create({
                    key: 'paladin sword attack',
                    frames:this.anims.generateFrameNumbers('paladin sword', {start: 23, end:29}),
                    frameRate:10,
                    repeat:0
                })
                this.anims.create({
                    key: 'paladin hammer attack',
                    frames:this.anims.generateFrameNumbers('paladin hammer', {start: 23, end:28}),
                    frameRate:5,
                    repeat:0
                })
                this.anims.create({
                    key: 'hammerattack',
                    frames: this.anims.generateFrameNumbers('hammer', { start: 0, end: 8 }),
                    frameRate: 20,
                    repeat: 0
                });
                
                

                ennemy = this.physics.add.sprite(750, 750, 'ennemy').setScale(0.2);

                ennemy.setSize(550, 550, true);
                this.physics.add.collider(ennemy, platforms);
                this.physics.add.collider(player, ennemy, handlePlayerEnnemyCollision, null, this);
                ennemy.setBounce(0.5);
                ennemy.setCollideWorldBounds(true);
                ennemy.allowGravity = true;
                //this.ennemy.vivant=true

                Heavyennemy = this.physics.add.sprite(1750, 1930, 'Heavyennemy').setScale(0.5);

                this.physics.add.collider(Heavyennemy, platforms);
                this.physics.add.collider(player, Heavyennemy, null, this);
                Heavyennemy.setBounce(0.5);
                Heavyennemy.setCollideWorldBounds(true);

                Heavyennemy.allowGravity = true;

                lance = this.physics.add.sprite(350, 400);

                lance.setSize(120, 60, true);
                //lance.setOffsize(10,10,true);

                this.physics.add.collider(lance, platforms);
                this.physics.add.collider(player, ennemy, null, this);
                lance.setCollideWorldBounds(true);
                lance.setBounce(0.5);
                lance.setImmovable(true);
                lance.allowGravity = true

                //UTILISATION DE L'EPEE
                sword = this.physics.add.sprite(1000, 1000, 'epée');
                sword.setOrigin(0, 0);
                sword.setSize(200, 40);
                sword.setImmovable(true);
                swordColliders = this.physics.add.group();
                swordColliders.add(sword);
                this.physics.add.overlap(player, sword, gravitysword);
                this.physics.add.overlap(sword, ennemy, attack);
                this.physics.add.collider(ennemy, swordColliders, handleSwordCollision, null, this);
                attack = this.input.keyboard.addKey('space');
                this.physics.add.collider(sword, ennemy, attack);


                // UTILISATION DU MARTEAU
                hammer = this.physics.add.sprite(1000, 1000, 'hammer').setScale(2);
                hammer.setOrigin(0, 0);
                hammer.setSize(60, 40);
                hammer.setImmovable(true);
                hammerColliders = this.physics.add.group();
                hammerColliders.add(hammer);
                this.physics.add.overlap(player, hammer, gravityhammer);
                this.physics.add.collider(hammer, ennemy, chockwave);
                this.physics.add.collider(hammer, Heavyennemy, chock);
                this.physics.add.collider(ennemy, hammerColliders, handleHammerCollision, null, this);
                attackhammer = this.input.keyboard.addKey('shift');


                this.pointer=this.input.activePointer;


                

        
                
            }
            

        
            update() {
                
                if (this.pointer.isDown){
                    console.log(this.pointer.worldX,this.pointer.worldY)
                    }

                porte.x=4750
                porte.y=2200
                this.physics.add.collider(porte,platforms,null, this);
                if (equipe == 'paladin sword') {
                    if (cursors.left.isDown) { //si la touche gauche est appuyée
                        player.setVelocityX(-260); //alors vitesse négative en X
                        player.anims.play('left sword', true); //et animation => gauche
                    }
                    else if (cursors.right.isDown) { //sinon si la touche droite est appuyée
                        player.setVelocityX(260); //alors vitesse positive en X
                        player.anims.play('right sword', true); //et animation => droite
                    }
                    else if (cursors.space.isUp) { // sinon
                        player.setVelocityX(0); //vitesse nulle
                        player.anims.play('turn sword'); //animation fait face caméra
                    }
                }
                if (equipe == 'paladin hammer') {
                    if (cursors.left.isDown) { //si la touche gauche est appuyée
                        player.setVelocityX(-260); //alors vitesse négative en X
                        player.anims.play('left hammer', true); //et animation => gauche
                    }
                    else if (cursors.right.isDown) { //sinon si la touche droite est appuyée
                        player.setVelocityX(260); //alors vitesse positive en X
                        player.anims.play('right hammer', true); //et animation => droite
                    }
                    else if (cursors.space.isUp) { // sinon
                        player.setVelocityX(0); //vitesse nulle
                        player.anims.play('turn hammer'); //animation fait face caméra
                    }
                }
                if (cursors.up.isDown && player.body.touching.down) {//si touche haut appuyée ET que le perso touche le sol
                    player.setVelocityY(-330); //alors vitesse verticale négative
                    //(on saute)
                }
                if (cursors.space.isDown && player.body.touching.down && equipe == 'paladin sword') {
                    player.anims.play("paladin sword attack", true)
                    swordactive = true
                    attack

                    sword.x = player.x + 20;
                    sword.y = player.y - 10;
                }
                if (cursors.space.isDown && player.body.touching.down && equipe == 'paladin hammer') {
                    player.anims.play("paladin hammer attack", true)

                    hammer.anims.play("hammerattack", true)
                    hammeractive = true

                    hammer.x = player.x + 20
                    hammer.y = player.y - 70;
                }
                
                if (cursors.shift.isDown){
                    cursors.shift.reset()
                    cursors.shift.enable=false

                    if (equipe=="paladin sword"){
                        equipe="paladin hammer"
                        player.setTexture('paladin hammer')
                        setTimeout(()=>{
                            cursors.shift.enable=true
                        },1000)
                    }

                    else if (equipe=="paladin hammer"){
                        equipe="paladin sword"
                        player.setTexture('paladin sword')
                        setTimeout(()=>{
                            cursors.shift.enable=true
                        },1000)

                    }
                    
                    var distance = Phaser.Math.Distance.Between(ennemy.x, player.x,);
                    if (distance < 175) {
                        ennemy.setVelocityX(player.x - ennemy.x)
                        
                    }
                    else { ennemy.setVelocity(0) }
                    //
                    if (Math.abs(ennemy.body.velocity.x) > Math.abs(ennemy.body.velocity.y)) {
                        if (ennemy.body.velocity.x > 0) {
                            console.log("droite")
                            ennemy.anims.play('right');
                        }
                        if (ennemy.body.velocity.x < 0) {
                            console.log("gauche")
                            ennemy.anims.play('left');
                        }
                    }
    
        
                    
                }    

            }
        
            nextscene() {
                this.scene.start("level3")
            }

        

        }  
        
        class level3 extends Phaser.Scene {
            constructor() {
                super('level3');
            }
            preload() {

            }
            create() {

            }
            update() {

            }
        }


        var config = {
            type: Phaser.AUTO,
            width: 1600, height: 900,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 200 },
                    debug: true

                }
            },
            scene: [title, tuto,level1,level2,level3]

        }; new Phaser.Game(config);
    </script>
</body>

</html>